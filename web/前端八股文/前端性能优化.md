# 前端性能优化

## 一、网站传输优化

1.  :star: **升级服务器带宽**（个人网站1-5M实惠够用，现在一般是8M，企业用嘛有钱就行）

2. **升级服务器的 CPU 和内存**。如果网站有复杂的后端逻辑需要此项，纯静态网站传输则忽略此项

3. **使用 CD N内容分发网络**，贵啊，非必要不用，这是用尽了所有手段之后还需要增加性能才使用

4.  :star: **配置浏览器缓存**。使用 Nginx 配置HTTP缓存请求头，和 CDN 浏览器缓存过期配置

5.  :star: **升级为 `HTTP 2`** 。多路复用，并行传输

   `HTTP 1.1`可以建立多的连接，但是每个连接内的请求串行处理，容易造成队头阻塞的问题

   `HTTP 2` 在单个连接上就能同时处理多个请求，实现并行传输

   开启方式：

   1. Nginx 配置 `listen 443 ssl http2`
   2. 在 CDN 直接配置 `HTTP 2.0`

## 二、打包体积优化

1. :star: **将 `jpg` 和 `png` 的图片压缩为 `webp` 格式**（图片往往比代码大很多，所以这很重要）。

   可以节省 `20%` 以上的文件体积，极致压缩 -> 图片压缩的质量可以为 `80%` 对原图的影响较小

2. **代码压缩**。`Vite / Webpack` 会自动帮我们 `tree shaking` 和压缩代码（删除注释及缩短变量名）

3. **服务器配置 `gzip` 压缩**。:point_right: Nginx 配置 `gzip on;`

   1. 浏览器告诉服务器，支持`gzip` 压缩，
   2. 服务器把文件压缩后，通过响应头 `Content-Encoding: gzip` 告诉浏览器，这是压缩过的文件
   3. 浏览器收到文件后会自动进行解压

4. **`Vite` 手动分包**，将多个小体积的 `chunk`文件为一个体积适中的 `chunk`，减少网站请求文件的数量。比如将 React生态 的打包成 `react-vender` 减少文件数量

5. **外部依赖包管理**：对于多个项目的公共包，可以把这些包作为外部依赖，排除在打包文件之外；然后通过 `CDN` 引入提速，这样多个项目下载这个包一次即可

## 三、网站加载优化

1. **延迟加载**：用户看得到的先加载，用户看不到的就延迟加载，该方法特别适合长页面和图片较多的网站

   比如通过图片自带的 `lazy` 属性实现懒加载

   ```html
   <img src='image.jpg' alt='' loading='lazy' />
   ```

2. **代码分割，按需加载**。通过 `Vite` 的 `manualChunks` 将代码分割成多个小文件，实现按需加载

3. **分层加载**。核心是先快后好，先让用户先看到东西，再根据情况提升质量；

   1. 缩略图，页面先加载低清小图，用户点击后再加载高清大图
   2.  :point_right: 渐进式加载：先加载模图小图，等图片加载完成成切换成高清大图

4. **预加载**。通过预先启动对该源的连接来提高性能

   ```html
   <link rel="preconnect" href="https://example.com" />
   ```

5. **雪碧图**。和小图标合并为一张图，然后使用 `CSS` 的 `background position` 移动图片到合适位置



## 四、检查网站性能

1. 使用浏览器的 `PerformanceObserver` 查看 `DCL、FP、FCP、L、LCP` 等指标 :point_right: [performance对象](../JavaScript/performance对象.md#DCL、FP、FCP、L、LCP "performance")
2. 使用其他网站分析工具