[新版本缓存](../../../Server/Nginx/缓存.md)



# 缓存策略

1. **强缓存：** 如果资源在缓存有效期内，浏览器直接从缓存中获取资源，不发送请求到服务器。
2. **协商缓存：** 如果资源过期或者缓存失效，浏览器会向服务器发送请求，根据服务器响应的缓存验证信息决定是否需要重新获取资源。

浏览器缓存是提高网页加载速度和性能的重要机制之一，合理地使用缓存策略可以有效减少网络流量和服务器负载，提升用户体验



# 使用缓存

浏览器缓存是指将资源（如HTML、CSS、JavaScript、图片等）存储在本地，以便在下次请求相同资源时能够直接从本地获取，而不需要再次从服务器下载。

1. 静态资源缓存

   通过HTTP头来控制缓存行为：

   - **Cache-Control**: 指定缓存策略，
   
     可选值：`max-age`、`no-cache`、`no-store`、`public`、`private`等
   
     默认值：无或者`no-cache`。
   
   - **Expires**: 设定缓存过期时间，但已被`Cache-Control`的`max-age`替代（直接使用`max-age`即可）。
   
   - **ETag**: 资源的唯一标识符，用于协商缓存。
   
   - **Last-Modified**: 资源的最后修改时间，用于协商缓存。
   
   - **If-None-Match**：用于协商缓存，包含**先前响应的ETag值**。如果资源未修改，服务器返回304状态码
   
   - **If-Modified-Since**：用于协商缓存，包含**先前响应的最后修改时间**。如果资源未修改，服务器返回304状态码

```javascript
headers: {
    'Cache-Control': 'max-age=31536000',
    'If-None-Match': '<etag-value>',
    'If-Modified-Since': 'Wed, 21 Oct 2015 07:28:00 GMT',
}
```



# 使用缓存策略的原因

1. **减少网络传输和服务器负载：** 缓存使得浏览器可以直接从本地获取资源，而不需要每次都向服务器发送请求。这减少了网络流量和服务器负载，有助于减少服务器成本和提高网站的整体性能。
2. **加快页面加载速度：** 通过缓存，浏览器可以直接从本地获取资源，而不必等待服务器响应。这可以大大减少页面加载时间，提高网站的响应速度和用户体验。
3. **降低带宽成本：** 缓存可以减少网络传输量，节省带宽成本。特别是对于大型网站或拥有大量访问量的网站来说，减少带宽成本是非常重要的。
4. **提高网站可用性：** 当服务器出现故障或者网络连接不稳定时，缓存可以提供临时的备份方案，使得用户仍然可以访问到网站的内容，提高了网站的可用性。
5. **改善用户体验：** 加快页面加载速度和提高网站的响应速度可以改善用户体验，降低用户的等待时间，增加用户的满意度和忠诚度。



## 强缓存

1. **实现方式：**
   - ==使用响应头部中的 `Cache-Control` 和 `Expires` 字段控制资源的缓存策略==。
   - `Cache-Control` 指定缓存策略的行为，例如 `max-age` 表示资源在缓存中有效的最大时间。
   - `Expires` 字段指定了资源的过期时间，是一个绝对时间点。
2. **存在意义：**
   - 减少服务器负载和网络流量：客户端可以直接从缓存中获取资源，减少了对服务器的请求，降低了网络流量。
   - 提高网页加载速度：直接从缓存中获取资源，加快了页面的加载速度，提升了用户体验。
3. **其他功能：**
   - `no-cache` 和 `no-store` 指令：`no-cache` 表示需要验证缓存是否过期，`no-store` 表示不缓存任何内容。
   - `must-revalidate` 指令：表示必须在服务器上验证缓存是否过期，如果过期则不使用缓存。



## 协商缓存

1. **实现方式：**
   - ==使用响应头部中的 `Last-Modified` 和 `ETag` 字段来标识资源的版本信息==。
   - 浏览器在后续请求中会通过请求头部中的 `If-Modified-Since` 和 `If-None-Match` 字段向服务器发送上次请求时获取的资源的版本信息。
   - 服务器根据这些信息判断资源是否修改，如果未修改则返回 304 Not Modified，浏览器可以直接从缓存中获取资源。
2. **存在意义：**
   - 减少数据传输量：服务器通过验证缓存是否过期来决定是否返回资源内容，避免了不必要的数据传输。
   - 降低服务器负载：不需要返回实际的资源内容，只需返回状态码和头部信息，降低了服务器的负载。
3. **其他功能：**
   - `If-Modified-Since` 和 `If-None-Match` 字段：用于向服务器提供上次请求时获取的资源的版本信息。
   - `Last-Modified` 和 `ETag` 字段：用于在响应头部中提供资源的版本信息。

### 协商缓存作为一种补充策略被引入

1. **缓存更新频率控制：** 强缓存会在一定时间内直接使用缓存副本，但这意味着即使资源在服务器端已经更新，客户端也无法获知，直到缓存过期。使用协商缓存可以使客户端向服务器发送条件请求，服务器可以根据资源是否已经更新来返回适当的响应，从而控制缓存的更新频率。
2. **缓存的灵活性和动态性：** 强缓存的缓存过期时间是固定的，一旦过期，浏览器就会重新请求资源。但有些资源可能并不频繁更新，而且如果没有更新，强缓存的过期时间到了之后，也会重新请求资源。使用协商缓存可以根据资源的实际情况动态地更新缓存策略，避免不必要的网络请求。
3. **服务器负载的控制：** 强缓存的过期时间是由服务器在响应头中指定的，这意味着服务器需要负责缓存的过期策略。而协商缓存允许服务器根据资源的更新状态来动态地控制缓存的有效性，减少不必要的服务器负载。
4. **更精细的缓存控制：** 协商缓存允许服务器根据资源的特性和需求，更精细地控制缓存的有效性。通过使用 ETag 和 Last-Modified 字段，服务器可以提供更精确的资源验证机制，而不仅仅是基于时间的过期策略。
