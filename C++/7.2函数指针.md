# 函数指针

**函数指针是“指向函数的指针变量”**，保存的是**函数入口地址**

1. 定义

   ```c++
   int add(int a, int b) {
       return a + b;
   }
   
   int(*funcPtr) (int, int) = add;
   ```

2. 赋值

   ```c++
   int(*funcPtr) (int, int) = nullptr;
   
   // 以下两种赋值方式等价
   funcPtr = add;
   funcPtr = &add;
   ```

3. 调用

   ```c++
   // 函数指针的调用
   cout << (*funcPtr)(1, 2) << endl;
   cout << funcPtr(1, 2) << endl;
   ```



## 函数指针作为形参

**函数不能作为函数的形参**，但是函数指针可以

1. 举例

   ```c++
   int add(int a, int b) {
       return a + b;
   }
   
   int sub(int a, int b) {
       return a - b;
   }
   
   // op 是一个“函数指针参数”
   int calc(int a, int b, int (*op)(int, int)) {
       return op(a, b);
   }
   ```

2. 使用类型定义简化写法

   ```c++
   typedef int calcFunc(int, int);       // 函数类型
   typedef int (*calcFunc)(int, int);    // 函数指针类型
   
   int calc(int a, int b, calcFunc) {
       return calcFunc(a, b);
   }
   ```

   使用`decltype`

   ```c++
   typedef decltype(add) calcFunc;      // 函数类型
   typedef decltype(add) *calcFunc;     // 函数指针类型
   
   int calc(int a, int b, calcFunc) {
       return calcFunc(a, b);
   }
   ```



## 函数指针作为函数返回值

1. 基础示例

   ```c++
   // 返回一个：int (*)(int, int) 类型的函数指针
   int (*getOp(char op))(int, int) {
       if (op == '+') return add;
       if (op == '-') return sub;
       return nullptr;
   }
   ```

   ```c++
   int (*getOp(char))(int, int)
   ```

   从里向外读：

   1. `getOp(char)` —— 函数
   2. `*getOp(char)` —— 返回一个指针
   3. `(*getOp(char))(int, int)` —— 指向函数
   4. `int` —— 返回值类型

2. 用 `typedef` 简化

   ```c++
   typedef int (*Op)(int, int);
   
   Op getOp(char op) {
       if (op == '+') return add;
       if (op == '-') return sub;
       return nullptr;
   }
   ```

3. 用 `using` 简化（C++11）

   ```c++
   using Op = int (*)(int, int);
   
   Op getOp(char op) {
       if (op == '+') return add;
       if (op == '-') return sub;
       return nullptr;
   }
   ```

   

