# 定义数组

## 基本定义

### 定义**一维数组**

1. 定义

  ```c
  int arr[5];
  ```

2. **赋初值**

  ```c
  int arr[5] = {1, 2, 3, 4, 5};
  int arr[5] = {1, 2};                 // 剩下默认为 0，arr = {1, 2, 0, 0, 0}
  ```

  ```c
  int arr[] = {1, 2, 3, 4, 5};         // 自动自动推断大小
  ```

3. **字符串数组**

  注意`'\0'`

  ```c
  char s1[5] = {'h','e','l','l','o'};  // 不带 '\0'
  char s2[6] = "hello";                // 自动含 '\0'
  char s3[]  = "hello";                // 自动推断长度 = 6
  ```

4. 指针 + `malloc` 动态定义数组

  ```c
  int *arr = (int*)malloc(sizeof(int) * 10);
  ```

  释放

  ```c
  free(arr);
  ```

### 定义**二维数组**

1. 定义、赋初值

  ```c
  int arr[3][4];                 // 3 行 4 列
  
  int arr[3][4] = {
      {1, 2, 3, 4},
      {5, 6, 7, 8},
      {9,10,11,12}
  };
  ```

2. 动态二维数组

  ```c
  int row1[3] = {1,2,3};
  int row2[3] = {4,5,6};
  int *arr[2] = {row1, row2};  // 指针数组
  ```

3. 动态分配内存

  ```c
  int **arr = malloc(sizeof(int*) * rows);
  for (int i = 0; i < rows; i++) {
      arr[i] = malloc(sizeof(int) * cols);
  }
  ```

  一次性分配（更快）

  ```c
  int *arr = malloc(sizeof(int) * rows * cols);
  ```

  释放内存

  ```c
  for(int i = 0; i < rows; i++)
      free(arr[i]);
  free(arr);
  ```



## 其他定义方式

1. 使用 `typedef` 定义数组类型

   ```c
   typedef int ARR5[5];
   
   ARR5 a = {1, 2, 3, 4, 5};
   ```

2. **const 数组**

   不能修改元素

   ```c
   const int arr[3] = {1, 2, 3};
   ```

3. **数组 + 结构体**

   ```c
   typedef struct {
       int x, y;
   } Point;
   
   Point arr[5];   // 结构体数组
   ```



# 获取长度

## 用 `sizeof` 计算长度

1. 一维数组

   ```c
   int main() {
       int arr[80];
       int length = sizeof(arr) / sizeof(int);
       int len = sizeof(arr) / sizeof(arr[0]);
   }
   ```

   ```c
   // 获取数组长度函数，函数参考使用，没有实际使用价值
   int getArrayLength(int* arr, int len) {
       // 此处如果访问 sizeof(arr) 得到是指针大小，不是数组大小
       return len;
   }
   ```

   

2. 二维数组

   ```c
   int arr[3][4];
   
   int rows = sizeof(arr) / sizeof(arr[0]);            // 获取行数
   int cols = sizeof(arr[0]) / sizeof(arr[0][0]);      // 获取列数
   int count = sizeof(arr) / sizeof(arr[0][0]);        // 总元素个数
   ```

   

## 无法获取数组长度的情况

| 数组类型                  | 能否用 sizeof 获取长度 | 正确方式                     |
| ------------------------- | ---------------------- | ---------------------------- |
| **静态数组**              | ✔ 可以                 | `sizeof(arr)/sizeof(arr[0])` |
| **函数参数中的数组**      | ❌ 不可以               | 把长度作为参数传入           |
| **malloc 动态分配的数组** | ❌ 不可以               | 自己记录长度                 |

1. 数组作为函数参数时 —— 无法获取长度

   ```c
   // 把长度作为参数显式传入
   void func(int arr[], int length) {
       int len = sizeof(arr) / sizeof(arr[0]); // ❌ 错误！
   }
   ```

   函数参数 `int arr[]` 会退化（decay）成 `int *arr`，此时：`sizeof(arr)` 得到的是 **指针大小**（通常 4 或 8）

2. 动态数组（malloc）——无法用 `sizeof` 得到实际长度

   ```c
   int *arr = malloc(n * sizeof(int));
   int len = n;                          // 必须自己记录长度
   ```

   `sizeof(arr)` 得到 **指针大小**

# 数组参数的函数声明

1. 传入一维数组

   ```c
   void print(int* arr);
   void print(int arr[]);
   void print(int arr[5]);       // 写上5也没用，还不如用第二种方式
   ```

2. 传入数组长度（推荐）

   ```c
   void print(int arr[], int n);
   ```

3. **更标准：**

   ```c
   void print(int *arr, int n);
   ```

4. 二维数组作为参数也常被问到：

   ```c
   void print(int arr[][4], int rows);    // 二维数组的列数必须写
   void print(int arr[][], int rows);     // ❌ 编译错误
   ```
   
   
