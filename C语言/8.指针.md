# 一级指针

```c
int* p;           // 推荐使用该风格定义指针，类型是 int*，比较明确
int *p;           // 不推荐使用该风格定义指针，两种写法在编译器看来是等价的，风格区别而已
```

```c
int* p, q;        // p的类型是 int*，q的类型是 int；其实挺容易造成q也是指针的歧义。所以推荐一行代码定义一个指针就行

int* p;
int q;
```



## 指针与常量

```c
int a = 10;
int* p = &a;      // 或者 int *p; p = &a;

printf("p=%d, *p=%d\n", p, *p);                     // p=6487572, *p=10


// p = &a       p = a的地址
// *p = 10      *p 取出该地址的值，即 a 的值
```




## 指针与数组

1. 指向数组**首元素**（最常用）

   ```c
   int arr[5] = {1,2,3,4,5};
   int* p = arr;             // 或 int* p = &arr[0];
   
   printf("%d\n", *p);       // 1
   printf("%d\n", *(p+2));   // 3
   ```

2. 指向**整个数组**（指向数组的指针）

   ```c
   int arr[5] = {1,2,3,4,5};
   int (*p)[5] = &arr;  // p 是指向整个数组的指针
   ```

   `*p` 类型就是 `int[5]`

   ```c
   printf("%d\n", (*p)[0]); // 1
   printf("%d\n", (*p)[3]); // 4
   ```

3. 在函数参数中使用指针访问数组

   | 用法         | 指针类型                      | 访问方式                | 说明                       |
   | ------------ | ----------------------------- | ----------------------- | -------------------------- |
   | 指向首元素   | `int *p = arr`                | `*(p+i)`                | 最常用，数组退化为指针     |
   | 指向整个数组 | `int (*p)[N] = &arr`          | `(*p)[i]`               | 保留数组长度，适合函数传参 |
   | 函数参数     | `int *arr` 或 `int (*arr)[N]` | `arr[i]` 或 `(*arr)[i]` | 视情况选择                 |

   -  1：传递指向**首元素的指针**

     ```c
     void printArray(int *arr, int n){
         for(int i=0;i<n;i++)
             printf("%d ", arr[i]);
     }
     
     int main(){
         int arr[5]={1,2,3,4,5};
         printArray(arr,5);  // 或 printArray(&arr[0],5)
     }
     ```

   -  2：传递指向整个数组的指针

     区别：保留了数组大小信息

     ```c
     void printArray(int (*arr)[5]){
         for(int i=0;i<5;i++)
             printf("%d ", (*arr)[i]);
     }
     
     int main(){
         int arr[5]={1,2,3,4,5};
         printArray(&arr);
     }
     ```

---

`*p++` 的问题

`*` 与`++`是属于同一级的运算符，故从左到右运算 `*p++ = *p, p++`

`*p+1` = `(*p) + 1` ：`*`运算级别比 `+` 高



## 函数参数传递指针

1. 一维数组

   ```c
   void func(int *p, int n) {
       for(int i = 0; i < n; i++)
           p[i] += 10;
   }
   
   int main() {
       int arr[5] = {1,2,3,4,5};
       func(arr, 5);  // 传一维数组
       for(int i = 0; i < 5; i++)
           printf("%d ", arr[i]); // 11 12 13 14 15
   }
   ```

2. 一级指针参数 + 二维数组

   ```c
   void func(int *p, int rows, int cols) {
       for(int i = 0; i < rows * cols; i++)
           p[i] += 10;
   }
   
   int main() {
       int arr[3][4] = {
           {1,2,3,4},
           {5,6,7,8},
           {9,10,11,12}
       };
       func(&arr[0][0], 3, 4);  // 传首元素地址
   }
   ```

   



# 二级指针(指向指针的指针)

## 二级指针与常量

```c
int a = 10;
int *p = &a;      // 或者 int *p; p = &a;
int **pp = &p;

printf("p=%d, *p=%d\n", p, *p);                     // p=6487572, *p=10
printf("pp=%d, *pp=%d, **pp=%d", pp, *pp, **pp);    // pp=6487560, *pp=6487572, **pp=10

// 那么
// **pp = *p = a = 10     // 值
// *pp = p = &a;          // a 的地址，p = a的地址
// pp = &p = &&a;         // pp = p 的地址
```



## 二级指针与二维数组

1. 静态二维数组

   ```c
   int arr[3][4] = {
       {1, 100, 3, 4},
       {5, 6, 7, 8},
       {9,10,11,12},
   };
   int (*p)[4] = arr;              // 注意，(*p)有括号
   
   printf("p=%d, *p=%d, **p=%d\n", p, *p, **p);   // p=6487520, *p=6487520, **p=1
   
   printf("p[0][0] = %d\n", p[0][0]);             // 1
   printf("(*p)[3] = %d\n", (*p)[3]);             // 4, *p = arr[0]的地址
   printf("*(*p + 1) = %d\n", *(*p + 1));         // 100
   
   printf("**p = %d\n", **p);                     // 1
   p++;
   printf("**p = %d\n", **p);                     // 5
   ```

2. 动态二维数组

   ```c
   int row1[3] = {1,2,3};
   int row2[3] = {4,5,6};
   int *arr[2] = {row1, row2};   // 指针数组
   int **p = arr;                // 二级指针
   
   printf("%d\n", p[1][2]);      // 6
   ```

3. 动态内存分配

   ```c
   int rows = 3, cols = 4;
   int **arr = malloc(rows * sizeof(int*));
   
   for(int i = 0; i < rows; i++)
       arr[i] = malloc(cols * sizeof(int));
   ```

   内存不一定连续，**每行是单独分配的**



## 函数参数传递二级指针

1. 一维数组，传`&arr`

   ```c
   void modifyPointer(int **p) {
       static int b[5] = {10,20,30,40,50};
       *p = b;  // 修改外部一级指针指向
   }
   
   int main() {
       int *arr = NULL;
       modifyPointer(&arr);  // 传一级指针的地址 → 二级指针
       printf("%d\n", arr[2]);  // 30
   }
   ```

2. 静态二维数组 vs 二级指针，传`arr`

   ```c
   void func(int (*p)[4], int rows) {
       printf("%d\n", p[1][2]);  // 访问第二行第三列
   }
   
   int arr[3][4];
   func(arr, 3);  // 正确
   ```

3. 动态二维数组 + 二级指针，传`arr`

   ```c
   void func(int **p, int rows, int cols) {
       p[1][2] = 42;  // 修改第二行第三列
   }
   
   int **arr = malloc(rows * sizeof(int*));
   for(int i = 0; i < rows; i++)
       arr[i] = malloc(cols * sizeof(int));
   
   func(arr, rows, cols);  // 正确
   ```

   



# 多级指针
